<!-- 예시 코드입니다. (바꾸고싶다면 자유롭게 바꿔주세요) -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>로그인</title>
</head>
<body>
<h1>로그인</h1>

<form id="loginForm">
    <label for="username">아이디:</label>
    <input type="text" id="username" name="username" required><br>

    <label for="password">비밀번호:</label>
    <input type="password" id="password" name="password" required><br>

    <button type="submit">로그인</button>
</form>


<div id="loginResult"></div>


<div>
    <a href="/oauth2/authorization/google">Google로 로그인</a>
    <br>
    <a href="/oauth2/authorization/kakao">카카오 로그인</a>
</div>


<p>회원이 아니신가요? <a href="/user/register">회원가입</a></p>

<script type="module">
    const form = document.getElementById('loginForm');
    const result = document.getElementById('loginResult');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const username = form.username.value;
        const password = form.password.value;

        try {
            // 로그인 API 요청
            const response = await fetch('user/login', { // 구현한 컨트롤러 url에 따라 요청보내는 fetch url은 변경해줘야함
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            });

            if (response.ok) {
                const data = await response.json();

                // 서버에서 반환한 accessToken 저장
                localStorage.setItem("jwt", data.accessToken);

                result.innerText = "로그인 성공";

                window.location.href = "/";
            } else {
                const error = await response.text();
                result.innerText = `로그인 실패: ${error}`;
            }
        } catch (err) {
            console.error('에러:', err);
            result.innerText = '서버 오류가 발생했습니다.';
        }
    });
</script>
</body>
</html>